<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>{{ 'ULTIMA_ROTTA.SHEET.CHARACTER_CREATION' | translate }}</h2>
        <button class="btn btn-primary btn-sm" (click)="toggleForm()">{{ 'ULTIMA_ROTTA.SHEET.CREATE_NEW_CHARACTER' | translate }}</button>
    </div>

    <div *ngIf="showForm" class="mb-4">
        <form #characterForm="ngForm" (ngSubmit)="saveCharacter()">
            <div class="row g-1 mb-3">
                <div class="col-6 col-md-3">
                    <label for="name" class="form-label">{{ 'ULTIMA_ROTTA.SHEET.NAME' | translate }}</label>
                    <input type="text" id="name" class="form-control form-control-sm" [(ngModel)]="character.name" name="name" required>
                </div>
                <div class="col-6 col-md-3">
                    <label for="genetic" class="form-label">{{ 'ULTIMA_ROTTA.SHEET.GENETIC' | translate }}</label>
                    <select id="genetic" class="form-select form-select-sm" [(ngModel)]="character.genetic" name="genetic" required>
                        <option *ngFor="let option of genetic" [ngValue]="option.code">{{ option.description }}</option>
                    </select>
                </div>
                <div class="col-6 col-md-3">
                    <label for="role" class="form-label">{{ 'ULTIMA_ROTTA.SHEET.ROLE' | translate }}</label>
                    <select id="role" class="form-select form-select-sm" [(ngModel)]="character.role" name="role" required>
                        <option *ngFor="let option of roles" [ngValue]="option.code">{{ option.description }}</option>
                    </select>
                </div>
                <div class="col-6 col-md-3">
                    <label for="excellence" class="form-label">{{ 'ULTIMA_ROTTA.SHEET.EXCELLENCE' | translate }}</label>
                    <input type="text" id="excellence" class="form-control form-control-sm" [(ngModel)]="character.excellence" name="excellence" required>
                </div>
            </div>

            <h4>{{ 'ULTIMA_ROTTA.SHEET.ATTRIBUTES' | translate }}</h4>
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-1 mb-3">
                <div *ngFor="let attribute of attributeKeys" class="col mb-2">
                    <label [for]="attribute.code" class="form-label text-center w-100">{{ 'ULTIMA_ROTTA.ATTRIBUTES.' + attribute.code | translate }}</label>
                    <div class="d-flex justify-content-between align-items-center">
                        <input type="number" class="form-control form-control-sm me-1 w-50" [(ngModel)]="attributeValues[attribute.code].value" 
                               [name]="attribute.code + 'Value'" (ngModelChange)="updateAttributeHelper(attribute.code, 'value', $event)" 
                               placeholder="{{ 'ULTIMA_ROTTA.SHEET.VALUE' | translate }}" required>
                        <input type="number" class="form-control form-control-sm w-50" [(ngModel)]="attributeValues[attribute.code].bonus" 
                               [name]="attribute.code + 'Bonus'" (ngModelChange)="updateAttributeHelper(attribute.code, 'bonus', $event)" 
                               placeholder="{{ 'ULTIMA_ROTTA.SHEET.BONUS' | translate }}" required>
                    </div>
                </div>
            </div>

            <h4>{{ 'ULTIMA_ROTTA.SHEET.STATS' | translate }}</h4>
            <div class="row g-1 mb-3">
                <div class="col-4 col-md-2">
                    <label for="maxMana" class="form-label">{{ 'ULTIMA_ROTTA.SHEET.MAX_MANA' | translate }}</label>
                    <input type="number" id="maxMana" class="form-control form-control-sm" [(ngModel)]="character.maxMana" name="maxMana">
                </div>
                <div class="col-4 col-md-2">
                    <label for="maxLife" class="form-label">{{ 'ULTIMA_ROTTA.SHEET.MAX_LIFE' | translate }}</label>
                    <input type="number" id="maxLife" class="form-control form-control-sm" [(ngModel)]="character.maxLife" name="maxLife">
                </div>
                <div class="col-4 col-md-2">
                    <label for="armor" class="form-label">{{ 'ULTIMA_ROTTA.SHEET.ARMOR' | translate }}</label>
                    <input type="number" id="armor" class="form-control form-control-sm" [(ngModel)]="character.armor" name="armor">
                </div>
                <div class="col-4 col-md-2">
                    <label for="point_adventure" class="form-label">{{ 'ULTIMA_ROTTA.SHEET.ADVENTURE_POINTS' | translate }}</label>
                    <input type="number" id="point_adventure" class="form-control form-control-sm" [(ngModel)]="character.point_adventure" name="point_adventure">
                </div>
                <div class="col-4 col-md-2">
                    <label for="scrap" class="form-label">{{ 'ULTIMA_ROTTA.SHEET.SCRAP' | translate }}</label>
                    <input type="number" id="scrap" class="form-control form-control-sm" [(ngModel)]="character.scrap" name="scrap">
                </div>
            </div>

            <div class="row g-1 mb-3">
                <div class="col-md-6">
                    <label for="ability" class="form-label">{{ 'ULTIMA_ROTTA.SHEET.ABILITY' | translate }}</label>
                    <textarea id="ability" class="form-control form-control-sm" [(ngModel)]="character.ability" name="ability"></textarea>
                </div>
                <div class="col-md-6">
                    <label for="inventory" class="form-label">{{ 'ULTIMA_ROTTA.SHEET.INVENTORY' | translate }}</label>
                    <textarea id="inventory" class="form-control form-control-sm" [(ngModel)]="character.inventory" name="inventory"></textarea>
                </div>
                <div class="col-md-12">
                    <label for="background" class="form-label">{{ 'ULTIMA_ROTTA.SHEET.BACKGROUND' | translate }}</label>
                    <textarea id="background" class="form-control form-control-sm" [(ngModel)]="character.background" name="background"></textarea>
                </div>
            </div>

            <div class="d-flex justify-content-end">
                <button type="submit" class="btn btn-success btn-sm me-2" [disabled]="!characterForm.valid">{{ 'ULTIMA_ROTTA.SHEET.SAVE_CHARACTER' | translate }}</button>
                <button type="button" class="btn btn-secondary btn-sm" (click)="toggleForm()">{{ 'ULTIMA_ROTTA.SHEET.CANCEL' | translate }}</button>
            </div>
        </form>
    </div>

    <div *ngIf="characters.length > 0; else noCharacters" class="row g-2">
        <div *ngFor="let character of characters" class="col-12 col-md-6 col-lg-4">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="card-title">{{ character.name }}</h5>
                    <p class="card-text">{{ 'ULTIMA_ROTTA.SHEET.ROLE' | translate }}: {{ character.role }}</p>
                    <div class="btn-group" role="group">
                        <button class="btn btn-sm btn-outline-secondary" (click)="editCharacter(character)">{{ 'ULTIMA_ROTTA.SHEET.EDIT' | translate }}</button>
                        <button class="btn btn-sm btn-outline-danger" (click)="deleteCharacter(character)">{{ 'ULTIMA_ROTTA.SHEET.DELETE' | translate }}</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <ng-template #noCharacters>
        <div class="alert alert-info text-center">{{ 'ULTIMA_ROTTA.SHEET.NO_CHARACTERS' | translate }}</div>
    </ng-template>
</div>
